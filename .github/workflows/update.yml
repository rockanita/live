name: è‡ªåŠ¨æ›´æ–°M3U

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤©å‡Œæ™¨1ç‚¹ï¼ˆUTCæ—¶é—´ï¼‰æ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v3

      - name: åˆ›å»ºä¸´æ—¶ç›®å½•
        run: mkdir -p output

      - name: ä¸‹è½½ IPTV æºï¼ˆiptv.m3uï¼‰
        run: |
          curl -L https://live.fanmingming.cn/tv/m3u/iptv.m3u -o output/input.m3u

      - name: è¿‡æ»¤å¹¶è¾“å‡ºæ–°çš„ M3U æ–‡ä»¶ï¼ˆä¿ç•™ CCTV å’Œå«è§†ï¼‰
        run: |
          echo '#EXTM3U x-tvg-url="https://live.fanmingming.cn/e.xml"' > output/output.m3u
          grep -E 'CCTV|å«è§†' -A1 output/input.m3u >> output/output.m3u

      - name: å‘å¸ƒåˆ° gh-pages åˆ†æ”¯
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git fetch origin
          git checkout --orphan gh-pages
          mv output/output.m3u ./output.m3u
          git add output.m3u
          git commit -m "ğŸ“º è‡ªåŠ¨æ›´æ–° output.m3u"
          git push -f origin gh-pages
